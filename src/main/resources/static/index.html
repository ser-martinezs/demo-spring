<!-- index.html actualizado
  Cliente web para API de Libros con m√©todos GET, POST, PUT y DELETE.
  Endpoint base: https://demo-spring-qgp6.onrender.com/api/books
-->

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cliente API Libros (CRUD)</title>
  <style>
    :root { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    body { max-width: 900px; margin: 32px auto; padding: 16px; }
    header { display:flex; align-items:center; gap:12px; }
    h1 { margin:0; font-size:1.5rem; }
    .card { border:1px solid #eee; padding:12px; border-radius:8px; margin-top:12px; box-shadow:0 6px 18px rgba(0,0,0,0.03);} 
    label{display:block;margin-top:8px;font-size:0.9rem}
    input, button { font-size:1rem; padding:8px; border-radius:6px; border:1px solid #ccc; }
    button { cursor:pointer; }
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #eee;padding:8px;text-align:left}
    .muted{color:#666;font-size:0.9rem}
    .error{color:#a00}
    .success{color:#080}
    .actions button{margin-right:4px}
  </style>
</head>
<body>
  <header>
    <h1>Cliente Web para API de Libros</h1>
  </header>

  <div class="card">
    <strong>Crear o editar libro</strong>
    <form id="bookForm">
      <input type="hidden" id="bookId">

      <label for="title">T√≠tulo</label>
      <input id="title" name="title" required>

      <label for="author">Autor</label>
      <input id="author" name="author" required>

      <div style="margin-top:8px">
        <button type="submit">Guardar</button>
        <button id="cancelEdit" type="button">Cancelar</button>
      </div>
    </form>
    <div id="formMsg" class="muted" style="margin-top:8px"></div>
  </div>

  <div class="card">
    <strong>Listado de libros</strong>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="refreshBtn">Refrescar lista (GET)</button>
      <div id="listMsg" class="muted"></div>
    </div>

    <table id="booksTable" style="display:none">
      <thead><tr><th>ID</th><th>T√≠tulo</th><th>Autor</th><th>Acciones</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const BASE_URL = 'https://demo-spring-qgp6.onrender.com/api/books';

const bookForm = document.getElementById('bookForm');
const formMsg = document.getElementById('formMsg');
const refreshBtn = document.getElementById('refreshBtn');
const listMsg = document.getElementById('listMsg');
const booksTable = document.getElementById('booksTable');
const booksTbody = booksTable.querySelector('tbody');
const debug = document.getElementById('debug');
const cancelEdit = document.getElementById('cancelEdit');

function showDebug(...args){ debug.textContent = args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' '); }
function showMessage(el, text, ok=true){ el.textContent = text; el.className = ok ? 'success' : 'error'; setTimeout(()=>{ if(el) el.textContent = '' }, 5000); }

// Obtener lista de libros
async function fetchGet(){
  listMsg.textContent = 'Cargando...';
  try{
    const res = await fetch(BASE_URL);
    if(!res.ok) throw new Error('Status ' + res.status);
    const data = await res.json();
    renderList(data);
    listMsg.textContent = '√öltima carga: ' + new Date().toLocaleTimeString();
  }catch(err){
    listMsg.textContent = '';
    booksTable.style.display = 'none';
    showDebug('GET ERROR', err.message || err);
  }
}

function renderList(items){
  booksTbody.innerHTML = '';
  if(!items || items.length === 0){
    booksTable.style.display = 'none';
    listMsg.textContent = 'No hay libros.';
    return;
  }
  items.forEach(book => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${book.id ?? ''}</td>
      <td>${book.title ?? ''}</td>
      <td>${book.author ?? ''}</td>
      <td class="actions">
        <button onclick="editBook(${book.id}, '${book.title}', '${book.author}')">‚úèÔ∏è Editar</button>
        <button onclick="deleteBook(${book.id})">üóëÔ∏è Eliminar</button>
      </td>
    `;
    booksTbody.appendChild(tr);
  });
  booksTable.style.display = '';
}

// Crear o actualizar libro
bookForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const id = document.getElementById('bookId').value;
  const title = document.getElementById('title').value.trim();
  const author = document.getElementById('author').value.trim();
  if(!title || !author){ showMessage(formMsg, 'Todos los campos son requeridos', false); return; }

  const payload = { title, author };
  const method = id ? 'PUT' : 'POST';
  const url = id ? `${BASE_URL}/${id}` : BASE_URL;

  formMsg.textContent = id ? 'Actualizando...' : 'Creando...';
  try{
    const res = await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if(!res.ok) throw new Error('Status ' + res.status);
    showMessage(formMsg, id ? 'Libro actualizado' : 'Libro creado');
    bookForm.reset();
    document.getElementById('bookId').value = '';
    fetchGet();
  }catch(err){
    showMessage(formMsg, 'Error: ' + (err.message||err), false);
    showDebug(method + ' ERROR', err);
  }
});

// Eliminar libro
async function deleteBook(id){
  if(!confirm('¬øSeguro que deseas eliminar este libro?')) return;
  try{
    const res = await fetch(`${BASE_URL}/${id}`, { method: 'DELETE' });
    if(!res.ok) throw new Error('Status ' + res.status);
    showMessage(listMsg, 'Libro eliminado correctamente');
    fetchGet();
  }catch(err){
    showMessage(listMsg, 'Error al eliminar: ' + (err.message||err), false);
    showDebug('DELETE ERROR', err);
  }
}

// Editar libro (cargar datos al formulario)
function editBook(id, title, author){
  document.getElementById('bookId').value = id;
  document.getElementById('title').value = title;
  document.getElementById('author').value = author;
  showMessage(formMsg, 'Editando libro ID ' + id);
}

cancelEdit.addEventListener('click', ()=>{
  bookForm.reset();
  document.getElementById('bookId').value = '';
  formMsg.textContent = '';
});

refreshBtn.addEventListener('click', fetchGet);
fetchGet();
</script>
</body>
</html>
